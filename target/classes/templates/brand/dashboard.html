<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/base}">

<head>
    <title>Brand Dashboard</title>
</head>

<body>
    <main layout:fragment="content">

        <div class="container-custom py-8" x-data="brandDashboard()">

            <!-- Welcome Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">
                        Merhaba, <span x-text="$store.auth.user?.name || 'Marka'" class="text-primary"></span> üëã
                    </h1>
                    <p class="text-gray-600 mt-1">AI Influencer i√ßeriklerinizi y√∂netin</p>
                </div>
                <a href="/search" class="btn btn-primary">
                    üîç Yeni Creator Bul
                </a>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Active Orders -->
                <div class="bg-white border border-gray-200 rounded-xl p-5">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-gray-500 text-sm font-medium">Aktif Sipari≈üler</span>
                        <span
                            class="w-10 h-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center">‚è≥</span>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.activeOrders">0</p>
                    <p class="text-sm text-gray-500 mt-1">Devam eden</p>
                </div>

                <!-- Pending Review -->
                <div class="bg-white border border-gray-200 rounded-xl p-5">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-gray-500 text-sm font-medium">ƒ∞nceleme Bekleyen</span>
                        <span
                            class="w-10 h-10 bg-yellow-50 text-yellow-600 rounded-lg flex items-center justify-center">üëÅÔ∏è</span>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.pendingReview">0</p>
                    <p class="text-sm text-gray-500 mt-1">Onayƒ±nƒ±zƒ± bekliyor</p>
                </div>

                <!-- Completed -->
                <div class="bg-white border border-gray-200 rounded-xl p-5">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-gray-500 text-sm font-medium">Tamamlanan</span>
                        <span
                            class="w-10 h-10 bg-green-50 text-green-600 rounded-lg flex items-center justify-center">‚úÖ</span>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.completed">0</p>
                    <p class="text-sm text-gray-500 mt-1">Toplam sipari≈ü</p>
                </div>

                <!-- Total Spent -->
                <div class="bg-white border border-gray-200 rounded-xl p-5">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-gray-500 text-sm font-medium">Toplam Harcama</span>
                        <span
                            class="w-10 h-10 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center">üí≥</span>
                    </div>
                    <p class="text-2xl font-bold text-gray-900" x-text="Utils.formatPrice(stats.totalSpent)">‚Ç∫0</p>
                    <p class="text-sm text-gray-500 mt-1">Bu ay</p>
                </div>
            </div>

            <!-- Orders Requiring Action -->
            <div x-show="pendingReviewOrders.length > 0"
                class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8 flex items-center gap-4">
                <span class="text-2xl">‚ö†Ô∏è</span>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">ƒ∞nceleme Bekleyen Teslimatlar</h3>
                    <p class="text-sm text-gray-600"
                        x-text="pendingReviewOrders.length + ' sipari≈ü onayƒ±nƒ±zƒ± bekliyor'"></p>
                </div>
                <a href="/brand/orders" class="btn btn-sm btn-outline">ƒ∞ncele</a>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                <!-- Recent Orders -->
                <div class="lg:col-span-2">
                    <div class="bg-white border border-gray-200 rounded-xl">
                        <div class="flex justify-between items-center p-5 border-b border-gray-200">
                            <h2 class="font-semibold text-gray-900">üì¶ Son Sipari≈üler</h2>
                            <a href="/brand/orders" class="text-primary text-sm hover:underline">T√ºm√ºn√º G√∂r</a>
                        </div>

                        <div class="divide-y divide-gray-100">
                            <template x-for="order in recentOrders" :key="order.id">
                                <div class="flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors">
                                    <img :src="order.brief.productImage" class="w-14 h-14 object-cover rounded-lg"
                                        alt="Product" />
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium text-gray-900 truncate" x-text="getGigTitle(order.gigId)">
                                        </p>
                                        <p class="text-sm text-gray-500" x-text="Utils.formatDate(order.createdAt)"></p>
                                    </div>
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                        :class="{
                                              'bg-yellow-100 text-yellow-800': order.status === 'PENDING',
                                              'bg-blue-100 text-blue-800': order.status === 'IN_PROGRESS',
                                              'bg-purple-100 text-purple-800': order.status === 'DELIVERED',
                                              'bg-green-100 text-green-800': order.status === 'COMPLETED'
                                          }" x-text="getStatusText(order.status)"></span>
                                    <template x-if="order.status === 'DELIVERED'">
                                        <button class="btn btn-primary btn-sm" @click="openReviewModal(order)">
                                            ƒ∞ncele
                                        </button>
                                    </template>
                                </div>
                            </template>

                            <div x-show="recentOrders.length === 0" class="text-center py-12">
                                <div class="text-4xl mb-3">üõí</div>
                                <p class="text-gray-500">Hen√ºz sipari≈ü yok</p>
                                <a href="/search" class="btn btn-primary btn-sm mt-3">Creator Bul</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions & Favorites -->
                <div class="space-y-6">
                    <!-- Quick Actions -->
                    <div class="bg-white border border-gray-200 rounded-xl p-5">
                        <h2 class="font-semibold text-gray-900 mb-4">‚ö° Hƒ±zlƒ± Aksiyonlar</h2>
                        <div class="space-y-2">
                            <a href="/search"
                                class="flex items-center gap-3 p-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                                <span>üîç</span>
                                <span>Creator Ke≈üfet</span>
                            </a>
                            <a href="/brand/orders"
                                class="flex items-center gap-3 p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                <span>üì¶</span>
                                <span>T√ºm Sipari≈üler</span>
                            </a>
                            <a href="#"
                                class="flex items-center gap-3 p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                <span>‚ù§Ô∏è</span>
                                <span>Favorilerim</span>
                            </a>
                            <a href="#"
                                class="flex items-center gap-3 p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                <span>üí≥</span>
                                <span>√ñdeme Y√∂ntemleri</span>
                            </a>
                        </div>
                    </div>

                    <!-- Recent Creators -->
                    <div class="bg-white border border-gray-200 rounded-xl p-5">
                        <h2 class="font-semibold text-gray-900 mb-4">üë• Son √áalƒ±≈ütƒ±klarƒ±nƒ±z</h2>
                        <div class="space-y-3">
                            <template x-for="persona in recentCreators" :key="persona.id">
                                <a :href="'/creator/' + persona.id"
                                    class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                    <img :src="persona.profileImages[0]" class="w-10 h-10 rounded-full object-cover"
                                        :alt="persona.name" />
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900" x-text="persona.name"></p>
                                        <div class="flex items-center gap-1 text-sm">
                                            <span class="text-yellow-500">‚≠ê</span>
                                            <span class="text-gray-600" x-text="persona.stats.avgRating"></span>
                                        </div>
                                    </div>
                                    <span class="bg-gray-200 text-gray-600 text-xs px-2 py-1 rounded"
                                        x-text="persona.style"></span>
                                </a>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Modal -->
            <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center" x-show="reviewModal.open"
                x-cloak>
                <div class="bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <h3 class="font-bold text-xl mb-4">üîç Teslimatƒ± ƒ∞ncele</h3>

                        <template x-if="reviewModal.order">
                            <div>
                                <!-- Delivered Image -->
                                <div class="mb-6">
                                    <img :src="reviewModal.order.deliveryFile || 'https://picsum.photos/seed/delivery/600/400'"
                                        class="w-full rounded-lg" alt="Delivered work" />
                                    <p class="text-sm text-yellow-600 mt-2">‚ö†Ô∏è Bu filigranlƒ± √∂nizlemedir. Onay sonrasƒ±
                                        orijinal dosya a√ßƒ±lacaktƒ±r.</p>
                                </div>

                                <!-- Delivery Note -->
                                <div x-show="reviewModal.order.deliveryNote"
                                    class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                                    <span class="font-medium text-gray-900">Creator Notu:</span>
                                    <span class="text-gray-600" x-text="reviewModal.order.deliveryNote"></span>
                                </div>

                                <!-- Original Brief -->
                                <details class="bg-gray-50 border border-gray-200 rounded-lg mb-4">
                                    <summary class="p-4 cursor-pointer font-medium text-gray-900">üìã Orijinal Brief
                                    </summary>
                                    <div class="px-4 pb-4 text-gray-600">
                                        <p><strong>Senaryo:</strong> <span
                                                x-text="reviewModal.order.brief?.scenario"></span></p>
                                        <p><strong>Format:</strong> <span
                                                x-text="reviewModal.order.brief?.format"></span></p>
                                    </div>
                                </details>

                                <!-- Revision Request -->
                                <div x-show="showRevisionForm" class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Revizyon Notu</label>
                                    <textarea x-model="revisionNote"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg h-24"
                                        placeholder="Neyin deƒüi≈ümesini istiyorsunuz?"></textarea>
                                </div>
                            </div>
                        </template>

                        <div class="flex gap-3 justify-end pt-4 border-t border-gray-200">
                            <button class="btn btn-ghost" @click="closeReviewModal">Kapat</button>
                            <template x-if="!showRevisionForm">
                                <div class="flex gap-2">
                                    <button class="btn btn-warning" @click="showRevisionForm = true">
                                        üîÑ Revizyon ƒ∞ste
                                    </button>
                                    <button class="btn btn-success" @click="approveOrder">
                                        ‚úÖ Onayla
                                    </button>
                                </div>
                            </template>
                            <template x-if="showRevisionForm">
                                <div class="flex gap-2">
                                    <button class="btn btn-ghost" @click="showRevisionForm = false">ƒ∞ptal</button>
                                    <button class="btn btn-warning" @click="requestRevision">
                                        Revizyon G√∂nder
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function brandDashboard() {
                return {
                    stats: {
                        activeOrders: 2,
                        pendingReview: 1,
                        completed: 5,
                        totalSpent: 8500
                    },
                    recentOrders: MockData.orders.filter(o => o.brandId === 'brand_1').slice(0, 5),
                    pendingReviewOrders: MockData.orders.filter(o => o.brandId === 'brand_1' && o.status === 'DELIVERED'),
                    recentCreators: MockData.personas.slice(0, 3),
                    reviewModal: {
                        open: false,
                        order: null
                    },
                    showRevisionForm: false,
                    revisionNote: '',

                    getGigTitle(gigId) {
                        const gig = MockData.gigs.find(g => g.id === gigId);
                        return gig?.title || 'Bilinmeyen ƒ∞lan';
                    },

                    getStatusText(status) {
                        const texts = {
                            'PENDING': 'Beklemede',
                            'IN_PROGRESS': 'Hazƒ±rlanƒ±yor',
                            'DELIVERED': 'Teslim Edildi',
                            'COMPLETED': 'Tamamlandƒ±'
                        };
                        return texts[status] || status;
                    },

                    openReviewModal(order) {
                        this.reviewModal.order = order;
                        this.reviewModal.open = true;
                        this.showRevisionForm = false;
                        this.revisionNote = '';
                    },

                    closeReviewModal() {
                        this.reviewModal.open = false;
                        this.reviewModal.order = null;
                    },

                    approveOrder() {
                        if (this.reviewModal.order) {
                            this.reviewModal.order.status = 'COMPLETED';
                            Alpine.store('notify').success('Sipari≈ü onaylandƒ±! Orijinal dosya indirme linki e-posta ile g√∂nderildi.');
                            this.closeReviewModal();
                        }
                    },

                    requestRevision() {
                        if (this.reviewModal.order && this.revisionNote) {
                            this.reviewModal.order.status = 'IN_PROGRESS';
                            Alpine.store('notify').warning('Revizyon talebi g√∂nderildi. Creator bilgilendirildi.');
                            this.closeReviewModal();
                        }
                    }
                }
            }
        </script>

    </main>
</body>

</html>