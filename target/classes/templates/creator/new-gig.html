<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/dashboard-layout}">

<head>
    <title>Yeni ƒ∞lan Olu≈ütur</title>
</head>

<body>
    <div layout:fragment="content">

        <div class="container mx-auto px-4 py-8 max-w-3xl" x-data="newGigForm()">

            <!-- Breadcrumb -->
            <nav
                class="flex items-center text-sm text-gray-500 mb-8 bg-white px-4 py-3 rounded-xl border border-gray-100 shadow-sm">
                <a href="/creator/dashboard" class="hover:text-primary transition-colors flex items-center gap-1">
                    <i class="ph ph-house"></i>
                </a>
                <i class="ph ph-caret-right mx-2 text-xs text-gray-400"></i>
                <a href="/creator/gigs" class="hover:text-primary transition-colors">ƒ∞lanlarƒ±m</a>
                <i class="ph ph-caret-right mx-2 text-xs text-gray-400"></i>
                <span class="text-gray-900 font-medium">Yeni ƒ∞lan</span>
            </nav>

            <!-- Header -->
            <div class="mb-8 text-center">
                <div
                    class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-yellow-50 text-yellow-500 mb-4">
                    <i class="ph ph-sparkle text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900">Yeni ƒ∞lan Olu≈ütur</h1>
                <p class="text-gray-500 mt-2 text-lg">Hizmetinizi tanƒ±mlayƒ±n ve kazanmaya ba≈ülayƒ±n</p>
            </div>

            <form @submit.prevent="createGig" class="space-y-6">

                <!-- Basic Info Card -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4"><i class="ph ph-notepad mr-2"></i> Temel Bilgiler</h2>

                        <!-- Title -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">ƒ∞lan Ba≈ülƒ±ƒüƒ±</span>
                                <span class="label-text-alt" x-text="gig.title.length + '/80'"></span>
                            </label>
                            <input type="text" x-model="gig.title" maxlength="80"
                                placeholder="√ñrn: √úr√ºn√ºn√ºzle cafe ortamƒ±nda profesyonel fotoƒüraf"
                                class="input input-bordered" required />
                        </div>

                        <!-- Description -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">A√ßƒ±klama</span>
                            </label>
                            <textarea x-model="gig.description" rows="4"
                                placeholder="Hizmetinizi detaylƒ± bir ≈üekilde a√ßƒ±klayƒ±n. Neler dahil? Hangi formatlarda teslim?"
                                class="textarea textarea-bordered" required></textarea>
                        </div>

                        <!-- Category -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Kategori</span>
                            </label>
                            <select x-model="gig.category" class="select select-bordered" required>
                                <option value="">Kategori Se√ßin</option>
                                <option value="√úr√ºn Fotoƒüraf√ßƒ±lƒ±ƒüƒ±">üì¶ √úr√ºn Fotoƒüraf√ßƒ±lƒ±ƒüƒ±</option>
                                <option value="Sosyal Medya">üì± Sosyal Medya</option>
                                <option value="Oyun & Teknoloji">üéÆ Oyun & Teknoloji</option>
                                <option value="L√ºks Markalar">üíé L√ºks Markalar</option>
                                <option value="Moda">üëó Moda</option>
                                <option value="Yemek">üçï Yemek</option>
                            </select>
                        </div>

                        <!-- Tags -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Etiketler</span>
                                <span class="label-text-alt">Virg√ºlle ayƒ±rƒ±n</span>
                            </label>
                            <input type="text" x-model="tagsInput" placeholder="√ñrn: lifestyle, cafe, √ºr√ºn, instagram"
                                class="input input-bordered" />
                            <div class="flex flex-wrap gap-2 mt-2" x-show="parsedTags.length > 0">
                                <template x-for="tag in parsedTags">
                                    <span class="badge badge-primary" x-text="tag"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pricing & Delivery Card -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4"><i class="ph ph-currency-circle-dollar mr-2"></i> Fiyat & Teslim
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Price -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Fiyat (‚Ç∫)</span>
                                </label>
                                <div class="relative">
                                    <input type="number" x-model="gig.price" min="50" step="50" placeholder="500"
                                        class="input input-bordered w-full pl-8" required />
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-base-content/50">‚Ç∫</span>
                                </div>
                            </div>

                            <!-- Delivery Days -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Teslim S√ºresi (G√ºn)</span>
                                </label>
                                <select x-model="gig.deliveryDays" class="select select-bordered" required>
                                    <option value="1">1 G√ºn</option>
                                    <option value="2">2 G√ºn</option>
                                    <option value="3">3 G√ºn</option>
                                    <option value="5">5 G√ºn</option>
                                    <option value="7">7 G√ºn</option>
                                    <option value="14">14 G√ºn</option>
                                </select>
                            </div>

                            <!-- Revisions -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Revizyon Hakkƒ±</span>
                                </label>
                                <select x-model="gig.revisions" class="select select-bordered" required>
                                    <option value="0">Revizyon Yok</option>
                                    <option value="1">1 Revizyon</option>
                                    <option value="2">2 Revizyon</option>
                                    <option value="3">3 Revizyon</option>
                                    <option value="unlimited">Sƒ±nƒ±rsƒ±z</option>
                                </select>
                            </div>
                        </div>

                        <!-- Pricing Summary -->
                        <div class="bg-base-100 rounded-lg p-4 mt-4">
                            <div class="flex justify-between items-center">
                                <span class="text-base-content/70">Alƒ±cƒ± g√∂receƒüi fiyat:</span>
                                <span class="text-2xl font-bold text-primary"
                                    x-text="Utils.formatPrice(gig.price || 0)"></span>
                            </div>
                            <div class="flex justify-between items-center text-sm mt-2">
                                <span class="text-base-content/50">Platform komisyonu (%10):</span>
                                <span class="text-base-content/50"
                                    x-text="'- ' + Utils.formatPrice((gig.price || 0) * 0.1)"></span>
                            </div>
                            <div class="divider my-2"></div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium">Size kalacak:</span>
                                <span class="text-xl font-bold text-success"
                                    x-text="Utils.formatPrice((gig.price || 0) * 0.9)"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Images Card -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4"><i class="ph ph-image mr-2"></i> √ñrnek G√∂rseller</h2>
                        <p class="text-base-content/60 mb-4">Bu hizmet i√ßin daha √∂nce yaptƒ±ƒüƒ±nƒ±z i≈ülerden √∂rnekler
                            ekleyin</p>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <!-- Thumbnail (Main) -->
                            <div class="form-control col-span-2">
                                <label class="label">
                                    <span class="label-text font-medium">Ana G√∂rsel (Zorunlu)</span>
                                </label>
                                <div class="aspect-video bg-base-300 rounded-lg border-2 border-dashed border-base-content/20 
                                        flex items-center justify-center cursor-pointer hover:border-primary transition-colors"
                                    :class="{ 'border-primary': uploadedImages.thumbnail }"
                                    @click="$refs.thumbnailInput.click()">
                                    <template x-if="!uploadedImages.thumbnail">
                                        <div class="text-center">
                                            <i class="ph ph-camera text-4xl mb-2 text-base-content/40"></i>
                                            <p class="text-sm text-base-content/60">Ana g√∂rsel y√ºkle</p>
                                        </div>
                                    </template>
                                    <template x-if="uploadedImages.thumbnail">
                                        <img :src="uploadedImages.thumbnail"
                                            class="w-full h-full object-cover rounded-lg" />
                                    </template>
                                </div>
                                <input type="file" accept="image/*" class="hidden" x-ref="thumbnailInput"
                                    @change="handleImageUpload($event, 'thumbnail')" />
                            </div>

                            <!-- Additional Images -->
                            <template x-for="i in 2" :key="i">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Ek G√∂rsel</span>
                                    </label>
                                    <div class="aspect-square bg-base-300 rounded-lg border-2 border-dashed border-base-content/20 
                                            flex items-center justify-center cursor-pointer hover:border-primary transition-colors"
                                        @click="$refs['extraInput' + i].click()">
                                        <div class="text-center">
                                            <i class="ph ph-plus text-2xl text-base-content/40"></i>
                                        </div>
                                    </div>
                                    <input type="file" accept="image/*" class="hidden" :x-ref="'extraInput' + i" />
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Submit -->
                <div class="flex justify-end gap-4">
                    <a href="/creator/gigs" class="btn btn-ghost">ƒ∞ptal</a>
                    <button type="submit" class="btn btn-primary btn-lg gap-2" :disabled="!isFormValid">
                        <i class="ph ph-check text-xl"></i>
                        ƒ∞lanƒ± Yayƒ±nla
                    </button>
                </div>
            </form>
        </div>

        <script>
            function newGigForm() {
                return {
                    gig: {
                        title: '',
                        description: '',
                        category: '',
                        price: 500,
                        deliveryDays: '2',
                        revisions: '1'
                    },
                    tagsInput: '',
                    uploadedImages: {
                        thumbnail: null
                    },

                    get parsedTags() {
                        return this.tagsInput
                            .split(',')
                            .map(t => t.trim())
                            .filter(t => t.length > 0);
                    },

                    get isFormValid() {
                        return this.gig.title &&
                            this.gig.description &&
                            this.gig.category &&
                            this.gig.price >= 50;
                    },

                    handleImageUpload(event, type) {
                        const file = event.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.uploadedImages[type] = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    },

                    createGig() {
                        // Mock gig creation
                        const newGig = {
                            id: 'gig_' + Date.now(),
                            ...this.gig,
                            tags: this.parsedTags,
                            thumbnail: this.uploadedImages.thumbnail || 'https://picsum.photos/seed/' + Date.now() + '/400/300',
                            status: 'ACTIVE',
                            createdAt: new Date().toISOString()
                        };

                        // Save to localStorage
                        const gigs = JSON.parse(localStorage.getItem('myGigs') || '[]');
                        gigs.push(newGig);
                        localStorage.setItem('myGigs', JSON.stringify(gigs));

                        Alpine.store('notify').success('ƒ∞lan ba≈üarƒ±yla olu≈üturuldu!');

                        setTimeout(() => {
                            window.location.href = '/creator/gigs';
                        }, 1000);
                    }
                }
            }
        </script>

    </div>
</body>

</html>